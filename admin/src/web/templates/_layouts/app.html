{% extends "_layouts/base.html" %}
{% import "_macros/form.html" as Form %}
{% from "_macros/inst_dropdown.html" import inst_dropdown %}
{% block base_head %}
<script src="{{ url_for('static', filename='js/layout.js') }}" defer></script>
{% block head %}{% endblock %}
{% endblock %}
{% block base_body %}
<div class="relative bodyContainer h-full flex flex-col overflow-hidden">
  <header class="flex-none flex justify-between p-2 md:px-3 border-b shadow border-zinc-900">
    <div class="ml-2 flex items-center gap-4">
      <a href="/">
        <img src="https://cidepint.ing.unlp.edu.ar/wp-content/uploads/2019/09/LOGO-CIDEPINT-tripartito.png"
          alt="cidepint logo" class='w-10 h-10' />
      </a>
      {% if g.user and g.user_has_permissions(["setting_show", "setting_update"]) %}
      <a href="/admin">
        <span class="sr-only md:not-sr-only text-xl font-medium">Panel admin</span>
        <svg class="w-8 h-8 md:hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
          class="lucide lucide-layout-panel-left">
          <rect width="7" height="18" x="3" y="3" rx="1" />
          <rect width="7" height="7" x="14" y="3" rx="1" />
          <rect width="7" height="7" x="14" y="14" rx="1" />
        </svg>
      </a>
      {% endif %}
    </div>

    <nav class="flex md:mr-2">
      <ul class="flex gap-x-2 md:gap-x-4 text-xl font-medium items-center">
        <li class=" xs:hidden">
          <button id="openMainMenu" class=" px-3 py-1.5 text-lg text-zinc-200 bg-zinc-800 rounded">
            <span>Menu</span>
          </button>
        </li>
        {% if g.user %}
        {% if g.institutions|length %}
        <li class="hidden xs:block ">
          {{ inst_dropdown(
          "/admin/institutions" if g.user_has_permissions(("institution_index",)) else
          "/institutions", param_institution_id
          ) }}
        </li>
        {% endif %}
        {% if g.user_has_permissions([service_index]) %}
        <li class="hidden xs:block ">
          <a href="/tracking">
            <span class="sr-only md:not-sr-only">Seguimientos</span>
            <svg class="w-8 h-8 md:hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
              viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M13.09 20c.12.72.37 1.39.72 2H6c-1.11 0-2-.89-2-2V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v9.09c-.33-.05-.66-.09-1-.09c-.34 0-.67.04-1 .09V4h-5v8l-2.5-2.25L8 12V4H6v16h7.09M20 18v-3h-2v3h-3v2h3v3h2v-3h3v-2h-3Z" />
            </svg>
          </a>
        </li>
        {% endif %}
        <li class="hidden xs:flex relative">
          <button id="openPerfil" class="text-zinc-950 inline-block" data-toggle="tab">
            <span class="sr-only md:not-sr-only">Perfil</span>
            <svg class="w-8 h-8 md:hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </button>
          <div id="perfilContainer"
            class="absolute top-[175%] right-0 md:-right-3">
            <ul
              class="flex flex-col gap-4 p-4 items-center rounded-sm text-base bg-orange-200 ring-1 ring-zinc-900">
              <li class="flex shadow-sm hover:shadow-md">
                <a href="/profile"
                  class="w-full text-center underline-offset-1 hover:underline hover:text-black rounded px-8 py-4 bg-zinc-50/90 hover:bg-zinc-50">
                  <span>Configuracion</span>
                </a>
              </li>
              <li class="flex shadow-sm hover:shadow-md">
                <form class="w-full" action="/logout" method="post">
                  {{ Form.new_csrf_token() }}
                  <button
                    class="w-full text-center underline-offset-1 hover:underline hover:text-black rounded px-8 py-4 bg-zinc-50/90 hover:bg-zinc-50 ">
                    <span>Cerrar Sesion</span>
                  </button>
                </form>
                </a>
              </li>
            </ul>
          </div>
        </li>
        {% else %}
        <li class="hidden xs:block">
          <a href="/login">
            <span class="">Iniciar sesion</span>
          </a>
        </li>
        {% endif %}
      </ul>

      <div id="mainMenuContainer"
        class="hidden fixed top-0 left-0 right-0 bg-orange-200 border-b border-b-zinc-950 xs:hidden">
        <div class='relative'>
          <div class="absolute top-0 right-0">
            <button id="closeMainMenu"
              class=" px-3 py-2 ml-auto my-4 mr-4 bg-zinc-50/90 hover:bg-zinc-50 rounded text-xl font-medium">
              Cerrar
            </button>
          </div>
          <ul class="flex  flex-col gap-4 items-center text-xl font-semibold pt-24 pb-24">
            <li class="w-[16ch] flex shadow">
              <a href="/institutions"
                class="w-full text-center underline-offset-1 hover:underline hover:text-black rounded px-8 py-4 bg-zinc-50/90 hover:bg-zinc-50">
                <span>Instituciones</span>
              </a>
            </li>
            <li class="w-[16ch] flex shadow">
              <a href="/"
                class="w-full text-center underline-offset-1 hover:underline hover:text-black rounded px-8 py-4 bg-zinc-50/90 hover:bg-zinc-50">
                <span>Seguimientos</span>
              </a>
            </li>
            <li class="w-[16ch] flex shadow">
              <a href="/profile"
                class="w-full text-center underline-offset-1 hover:underline hover:text-black rounded px-8 py-4 bg-zinc-50/90 hover:bg-zinc-50">
                <span>Perfil</span>
              </a>
            </li>
            {% if g.user %}
            <li class="w-[16ch] flex shadow">
              <form class="w-full" action="/logout" method="post">
                {{ Form.new_csrf_token() }}
                <button
                  class="w-full text-center hover:text-black rounded px-8 md:px-0 py-4 md:py-2 bg-zinc-50/90 hover:bg-zinc-50 ">
                  Cerrar Sesion
                </button>
              </form>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="flex-1 flex flex-col overflow-x-hidden">{% block content %}Content placeholder{% endblock %}</div>
</div>
{% block body %}{% endblock %}
{% endblock %}
